import PouchDB from 'pouchdb';
import { Model } from 'uki';

var appList = {
	"data-binder": {"name":"data-binder","description":"A Mure app that is responsible for (re)binding data to graphics","author":"Alex Bigelow"}
};

class Mure extends Model {
  constructor () {
    super();
    this.appList = appList;
    // Check if we're even being used in the browser (mostly useful for getting
    // access to the applist in all-apps-dev-server.js)
    if (!document || !window) {
      return;
    }

    // Funky stuff to figure out if we're debugging (if that's the case, we want to use
    // localhost instead of the github link for all links)
    let windowTitle = document.getElementsByTagName('title')[0];
    windowTitle = windowTitle ? windowTitle.textContent : '';
    this.debugMode = window.location.hostname === 'localhost' && windowTitle.startsWith('Mure');

    // Figure out which app we are (or null if the mure library is being used somewhere else)
    this.currentApp = window.location.pathname.replace(/\//g, '');
    if (!this.appList[this.currentApp]) {
      this.currentApp = null;
    }

    // Create / load the local database of files
    this.lastFile = null;
    this.db = this.getOrInitDb();

    this.loadUserLibraries = false;
    this.runUserScripts = false;

    // default error handling (apps can listen for / display error messages in addition to this):
    this.on('error', errorMessage => { console.warn(errorMessage); });
    this.catchDbError = errorObj => { this.trigger('error', 'Unexpected error reading PouchDB:\n' + errorObj.stack); };

    // in the absence of a custom dialogs, just use window.prompt:
    this.prompt = window.prompt;
    this.confirm = window.confirm;
  }
  getOrInitDb () {
    let db = new PouchDB('mure');
    db.get('userPrefs').then(prefs => {
      this.lastFile = prefs.currentFile;
    }).catch(errorObj => {
      if (errorObj.message === 'missing') {
        return db.put({
          _id: 'userPrefs',
          currentFile: null
        });
      } else {
        this.catchDbError(errorObj);
      }
    });
    db.changes({
      since: 'now',
      live: true,
      include_docs: true
    }).on('change', change => {
      if (change.id === 'userPrefs') {
        if (this.lastFile !== change.doc.currentFile) {
          // Different filename... a new one was opened, or the current file was deleted
          this.lastFile = change.doc.currentFile;
          // This will have changed the current file list
          this.getFileList().then(fileList => {
            this.trigger('fileListChange', fileList);
          });
        }
        // Whether we have a new file, or the current one was updated, fire a fileChange event
        this.getFile(change.doc.currentFile).then(fileBlob => {
          this.trigger('fileChange', fileBlob);
        });
      } else if (change.deleted && change.id !== this.lastFile) {
        // If a file is deleted that wasn't opened, it won't ever cause a change
        // to userPrefs. So we need to fire fileListChange immediately.
        this.getFileList().then(fileList => {
          this.trigger('fileListChange', fileList);
        });
      }
    }).on('error', errorObj => {
      this.catchDbError(errorObj);
    });
    return db;
  }
  setCurrentFile (filename) {
    return this.db.get('userPrefs').then(prefs => {
      prefs.currentFile = filename;
      return this.db.put(prefs);
    }).catch(this.catchDbError);
  }
  getCurrentFilename () {
    return this.db.get('userPrefs').then(prefs => {
      return prefs.currentFile;
    });
  }
  getFile (filename) {
    if (filename) {
      return this.db.getAttachment(filename, filename);
    } else {
      return Promise.resolve(null);
    }
  }
  signalSvgLoaded (loadUserLibrariesFunc, runUserScriptsFunc) {
    // Only load the SVG's linked libraries + embedded scripts if we've been told to
    let callback = this.runUserScripts ? runUserScriptsFunc : () => {};
    if (this.loadUserLibraries) {
      loadUserLibrariesFunc(callback);
    }
    this.trigger('svgLoaded');
  }
  on (eventName, callback) {
    if (!Mure.VALID_EVENTS[eventName]) {
      throw new Error('Unknown event name: ' + eventName);
    } else {
      super.on(eventName, callback);
    }
  }
  customizeConfirmDialog (showDialogFunction) {
    this.confirm = showDialogFunction;
  }
  customizePromptDialog (showDialogFunction) {
    this.prompt = showDialogFunction;
  }
  openApp (appName) {
    window.open('/' + appName, '_blank');
  }
  getSvgBlob (filename) {
    return this.db.getAttachment(filename, filename)
      .catch(this.catchDbError);
  }
  saveSvgBlob (filename, blob) {
    let dbEntry = {
      _id: filename,
      _attachments: {}
    };
    dbEntry._attachments[filename] = {
      content_type: blob.type,
      data: blob
    };
    return this.db.get(filename).then(existingDoc => {
      // the file exists... overwrite the document
      dbEntry._rev = existingDoc._rev;
      return this.db.put(dbEntry);
    }).catch(errorObj => {
      if (errorObj.message === 'missing') {
        // the file doesn't exist yet...
        return this.db.put(dbEntry);
      } else {
        this.catchDbError(errorObj);
      }
    });
  }
  getFileList () {
    return this.db.allDocs()
      .then(response => {
        let result = [];
        response.rows.forEach(d => {
          if (d.id !== 'userPrefs') {
            result.push(d.id);
          }
        });
        return result;
      }).catch(this.catchDbError);
  }
  getFileRevisions () {
    return this.db.allDocs()
      .then(response => {
        let result = {};
        response.rows.forEach(d => {
          if (d.id !== 'userPrefs') {
            result[d.id] = d.value.rev;
          }
        });
        return result;
      }).catch(this.catchDbError);
  }
  uploadSvg (fileObj) {
    let filename = fileObj.name;
    return this.getFileRevisions().then(revisionDict => {
      // Ask multiple times if the user happens to enter another filename that already exists
      while (revisionDict[filename]) {
        let newName = this.prompt.call(window,
          fileObj.name + ' already exists. Pick a new name, or leave it the same to overwrite:',
          fileObj.name);
        if (!newName) {
          return null;
        } else if (newName === filename) {
          return filename;
        } else {
          filename = newName;
        }
      }
      return filename;
    }).then(filename => {
      if (filename) {
        return this.saveSvgBlob(filename, fileObj).then(() => {
          return this.setCurrentFile(filename);
        });
      }
    }).catch(this.catchDbError);
  }
  deleteSvg (filename) {
    if (this.confirm.call(window, 'Are you sure you want to delete ' + filename + '?')) {
      return Promise.all([this.db.get(filename), this.getCurrentFilename()]).then(promiseResults => {
        let existingDoc = promiseResults[0];
        let currentFile = promiseResults[1];
        return this.db.remove(existingDoc._id, existingDoc._rev)
          .then(removeResponse => {
            if (filename === currentFile) {
              this.setCurrentFile(null).catch(this.catchDbError);
            }
            return removeResponse;
          });
      }).catch(this.catchDbError);
    }
  }
  downloadSvg (filename) {
    this.getSvgBlob(filename).then(blob => {
      // create a fake link...
      let a = document.createElement('a');
      a.style = 'display:none';
      let url = window.URL.createObjectURL(blob);
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      window.URL.revokeObjectURL(url);
      a.parentNode.removeChild(a);
    }).catch(this.catchDbError);
  }
}

Mure.VALID_EVENTS = {
  fileListChange: true,
  fileChange: true,
  error: true,
  svgLoaded: true
};

let mure = new Mure();

export default mure;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXVyZS5lcy5qcyIsInNvdXJjZXMiOlsiLi4vc3JjL211cmUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFBvdWNoREIgZnJvbSAncG91Y2hkYic7XG5pbXBvcnQgYXBwTGlzdCBmcm9tICcuL2FwcExpc3QuanNvbic7XG5pbXBvcnQgeyBNb2RlbCB9IGZyb20gJ3VraSc7XG5cbmNsYXNzIE11cmUgZXh0ZW5kcyBNb2RlbCB7XG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuYXBwTGlzdCA9IGFwcExpc3Q7XG4gICAgLy8gQ2hlY2sgaWYgd2UncmUgZXZlbiBiZWluZyB1c2VkIGluIHRoZSBicm93c2VyIChtb3N0bHkgdXNlZnVsIGZvciBnZXR0aW5nXG4gICAgLy8gYWNjZXNzIHRvIHRoZSBhcHBsaXN0IGluIGFsbC1hcHBzLWRldi1zZXJ2ZXIuanMpXG4gICAgaWYgKCFkb2N1bWVudCB8fCAhd2luZG93KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gRnVua3kgc3R1ZmYgdG8gZmlndXJlIG91dCBpZiB3ZSdyZSBkZWJ1Z2dpbmcgKGlmIHRoYXQncyB0aGUgY2FzZSwgd2Ugd2FudCB0byB1c2VcbiAgICAvLyBsb2NhbGhvc3QgaW5zdGVhZCBvZiB0aGUgZ2l0aHViIGxpbmsgZm9yIGFsbCBsaW5rcylcbiAgICBsZXQgd2luZG93VGl0bGUgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGl0bGUnKVswXTtcbiAgICB3aW5kb3dUaXRsZSA9IHdpbmRvd1RpdGxlID8gd2luZG93VGl0bGUudGV4dENvbnRlbnQgOiAnJztcbiAgICB0aGlzLmRlYnVnTW9kZSA9IHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSA9PT0gJ2xvY2FsaG9zdCcgJiYgd2luZG93VGl0bGUuc3RhcnRzV2l0aCgnTXVyZScpO1xuXG4gICAgLy8gRmlndXJlIG91dCB3aGljaCBhcHAgd2UgYXJlIChvciBudWxsIGlmIHRoZSBtdXJlIGxpYnJhcnkgaXMgYmVpbmcgdXNlZCBzb21ld2hlcmUgZWxzZSlcbiAgICB0aGlzLmN1cnJlbnRBcHAgPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUucmVwbGFjZSgvXFwvL2csICcnKTtcbiAgICBpZiAoIXRoaXMuYXBwTGlzdFt0aGlzLmN1cnJlbnRBcHBdKSB7XG4gICAgICB0aGlzLmN1cnJlbnRBcHAgPSBudWxsO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSAvIGxvYWQgdGhlIGxvY2FsIGRhdGFiYXNlIG9mIGZpbGVzXG4gICAgdGhpcy5sYXN0RmlsZSA9IG51bGw7XG4gICAgdGhpcy5kYiA9IHRoaXMuZ2V0T3JJbml0RGIoKTtcblxuICAgIHRoaXMubG9hZFVzZXJMaWJyYXJpZXMgPSBmYWxzZTtcbiAgICB0aGlzLnJ1blVzZXJTY3JpcHRzID0gZmFsc2U7XG5cbiAgICAvLyBkZWZhdWx0IGVycm9yIGhhbmRsaW5nIChhcHBzIGNhbiBsaXN0ZW4gZm9yIC8gZGlzcGxheSBlcnJvciBtZXNzYWdlcyBpbiBhZGRpdGlvbiB0byB0aGlzKTpcbiAgICB0aGlzLm9uKCdlcnJvcicsIGVycm9yTWVzc2FnZSA9PiB7IGNvbnNvbGUud2FybihlcnJvck1lc3NhZ2UpOyB9KTtcbiAgICB0aGlzLmNhdGNoRGJFcnJvciA9IGVycm9yT2JqID0+IHsgdGhpcy50cmlnZ2VyKCdlcnJvcicsICdVbmV4cGVjdGVkIGVycm9yIHJlYWRpbmcgUG91Y2hEQjpcXG4nICsgZXJyb3JPYmouc3RhY2spOyB9O1xuXG4gICAgLy8gaW4gdGhlIGFic2VuY2Ugb2YgYSBjdXN0b20gZGlhbG9ncywganVzdCB1c2Ugd2luZG93LnByb21wdDpcbiAgICB0aGlzLnByb21wdCA9IHdpbmRvdy5wcm9tcHQ7XG4gICAgdGhpcy5jb25maXJtID0gd2luZG93LmNvbmZpcm07XG4gIH1cbiAgZ2V0T3JJbml0RGIgKCkge1xuICAgIGxldCBkYiA9IG5ldyBQb3VjaERCKCdtdXJlJyk7XG4gICAgZGIuZ2V0KCd1c2VyUHJlZnMnKS50aGVuKHByZWZzID0+IHtcbiAgICAgIHRoaXMubGFzdEZpbGUgPSBwcmVmcy5jdXJyZW50RmlsZTtcbiAgICB9KS5jYXRjaChlcnJvck9iaiA9PiB7XG4gICAgICBpZiAoZXJyb3JPYmoubWVzc2FnZSA9PT0gJ21pc3NpbmcnKSB7XG4gICAgICAgIHJldHVybiBkYi5wdXQoe1xuICAgICAgICAgIF9pZDogJ3VzZXJQcmVmcycsXG4gICAgICAgICAgY3VycmVudEZpbGU6IG51bGxcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmNhdGNoRGJFcnJvcihlcnJvck9iaik7XG4gICAgICB9XG4gICAgfSk7XG4gICAgZGIuY2hhbmdlcyh7XG4gICAgICBzaW5jZTogJ25vdycsXG4gICAgICBsaXZlOiB0cnVlLFxuICAgICAgaW5jbHVkZV9kb2NzOiB0cnVlXG4gICAgfSkub24oJ2NoYW5nZScsIGNoYW5nZSA9PiB7XG4gICAgICBpZiAoY2hhbmdlLmlkID09PSAndXNlclByZWZzJykge1xuICAgICAgICBpZiAodGhpcy5sYXN0RmlsZSAhPT0gY2hhbmdlLmRvYy5jdXJyZW50RmlsZSkge1xuICAgICAgICAgIC8vIERpZmZlcmVudCBmaWxlbmFtZS4uLiBhIG5ldyBvbmUgd2FzIG9wZW5lZCwgb3IgdGhlIGN1cnJlbnQgZmlsZSB3YXMgZGVsZXRlZFxuICAgICAgICAgIHRoaXMubGFzdEZpbGUgPSBjaGFuZ2UuZG9jLmN1cnJlbnRGaWxlO1xuICAgICAgICAgIC8vIFRoaXMgd2lsbCBoYXZlIGNoYW5nZWQgdGhlIGN1cnJlbnQgZmlsZSBsaXN0XG4gICAgICAgICAgdGhpcy5nZXRGaWxlTGlzdCgpLnRoZW4oZmlsZUxpc3QgPT4ge1xuICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCdmaWxlTGlzdENoYW5nZScsIGZpbGVMaXN0KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICAvLyBXaGV0aGVyIHdlIGhhdmUgYSBuZXcgZmlsZSwgb3IgdGhlIGN1cnJlbnQgb25lIHdhcyB1cGRhdGVkLCBmaXJlIGEgZmlsZUNoYW5nZSBldmVudFxuICAgICAgICB0aGlzLmdldEZpbGUoY2hhbmdlLmRvYy5jdXJyZW50RmlsZSkudGhlbihmaWxlQmxvYiA9PiB7XG4gICAgICAgICAgdGhpcy50cmlnZ2VyKCdmaWxlQ2hhbmdlJywgZmlsZUJsb2IpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSBpZiAoY2hhbmdlLmRlbGV0ZWQgJiYgY2hhbmdlLmlkICE9PSB0aGlzLmxhc3RGaWxlKSB7XG4gICAgICAgIC8vIElmIGEgZmlsZSBpcyBkZWxldGVkIHRoYXQgd2Fzbid0IG9wZW5lZCwgaXQgd29uJ3QgZXZlciBjYXVzZSBhIGNoYW5nZVxuICAgICAgICAvLyB0byB1c2VyUHJlZnMuIFNvIHdlIG5lZWQgdG8gZmlyZSBmaWxlTGlzdENoYW5nZSBpbW1lZGlhdGVseS5cbiAgICAgICAgdGhpcy5nZXRGaWxlTGlzdCgpLnRoZW4oZmlsZUxpc3QgPT4ge1xuICAgICAgICAgIHRoaXMudHJpZ2dlcignZmlsZUxpc3RDaGFuZ2UnLCBmaWxlTGlzdCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pLm9uKCdlcnJvcicsIGVycm9yT2JqID0+IHtcbiAgICAgIHRoaXMuY2F0Y2hEYkVycm9yKGVycm9yT2JqKTtcbiAgICB9KTtcbiAgICByZXR1cm4gZGI7XG4gIH1cbiAgc2V0Q3VycmVudEZpbGUgKGZpbGVuYW1lKSB7XG4gICAgcmV0dXJuIHRoaXMuZGIuZ2V0KCd1c2VyUHJlZnMnKS50aGVuKHByZWZzID0+IHtcbiAgICAgIHByZWZzLmN1cnJlbnRGaWxlID0gZmlsZW5hbWU7XG4gICAgICByZXR1cm4gdGhpcy5kYi5wdXQocHJlZnMpO1xuICAgIH0pLmNhdGNoKHRoaXMuY2F0Y2hEYkVycm9yKTtcbiAgfVxuICBnZXRDdXJyZW50RmlsZW5hbWUgKCkge1xuICAgIHJldHVybiB0aGlzLmRiLmdldCgndXNlclByZWZzJykudGhlbihwcmVmcyA9PiB7XG4gICAgICByZXR1cm4gcHJlZnMuY3VycmVudEZpbGU7XG4gICAgfSk7XG4gIH1cbiAgZ2V0RmlsZSAoZmlsZW5hbWUpIHtcbiAgICBpZiAoZmlsZW5hbWUpIHtcbiAgICAgIHJldHVybiB0aGlzLmRiLmdldEF0dGFjaG1lbnQoZmlsZW5hbWUsIGZpbGVuYW1lKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShudWxsKTtcbiAgICB9XG4gIH1cbiAgc2lnbmFsU3ZnTG9hZGVkIChsb2FkVXNlckxpYnJhcmllc0Z1bmMsIHJ1blVzZXJTY3JpcHRzRnVuYykge1xuICAgIC8vIE9ubHkgbG9hZCB0aGUgU1ZHJ3MgbGlua2VkIGxpYnJhcmllcyArIGVtYmVkZGVkIHNjcmlwdHMgaWYgd2UndmUgYmVlbiB0b2xkIHRvXG4gICAgbGV0IGNhbGxiYWNrID0gdGhpcy5ydW5Vc2VyU2NyaXB0cyA/IHJ1blVzZXJTY3JpcHRzRnVuYyA6ICgpID0+IHt9O1xuICAgIGlmICh0aGlzLmxvYWRVc2VyTGlicmFyaWVzKSB7XG4gICAgICBsb2FkVXNlckxpYnJhcmllc0Z1bmMoY2FsbGJhY2spO1xuICAgIH1cbiAgICB0aGlzLnRyaWdnZXIoJ3N2Z0xvYWRlZCcpO1xuICB9XG4gIG9uIChldmVudE5hbWUsIGNhbGxiYWNrKSB7XG4gICAgaWYgKCFNdXJlLlZBTElEX0VWRU5UU1tldmVudE5hbWVdKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gZXZlbnQgbmFtZTogJyArIGV2ZW50TmFtZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN1cGVyLm9uKGV2ZW50TmFtZSwgY2FsbGJhY2spO1xuICAgIH1cbiAgfVxuICBjdXN0b21pemVDb25maXJtRGlhbG9nIChzaG93RGlhbG9nRnVuY3Rpb24pIHtcbiAgICB0aGlzLmNvbmZpcm0gPSBzaG93RGlhbG9nRnVuY3Rpb247XG4gIH1cbiAgY3VzdG9taXplUHJvbXB0RGlhbG9nIChzaG93RGlhbG9nRnVuY3Rpb24pIHtcbiAgICB0aGlzLnByb21wdCA9IHNob3dEaWFsb2dGdW5jdGlvbjtcbiAgfVxuICBvcGVuQXBwIChhcHBOYW1lKSB7XG4gICAgd2luZG93Lm9wZW4oJy8nICsgYXBwTmFtZSwgJ19ibGFuaycpO1xuICB9XG4gIGdldFN2Z0Jsb2IgKGZpbGVuYW1lKSB7XG4gICAgcmV0dXJuIHRoaXMuZGIuZ2V0QXR0YWNobWVudChmaWxlbmFtZSwgZmlsZW5hbWUpXG4gICAgICAuY2F0Y2godGhpcy5jYXRjaERiRXJyb3IpO1xuICB9XG4gIHNhdmVTdmdCbG9iIChmaWxlbmFtZSwgYmxvYikge1xuICAgIGxldCBkYkVudHJ5ID0ge1xuICAgICAgX2lkOiBmaWxlbmFtZSxcbiAgICAgIF9hdHRhY2htZW50czoge31cbiAgICB9O1xuICAgIGRiRW50cnkuX2F0dGFjaG1lbnRzW2ZpbGVuYW1lXSA9IHtcbiAgICAgIGNvbnRlbnRfdHlwZTogYmxvYi50eXBlLFxuICAgICAgZGF0YTogYmxvYlxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuZGIuZ2V0KGZpbGVuYW1lKS50aGVuKGV4aXN0aW5nRG9jID0+IHtcbiAgICAgIC8vIHRoZSBmaWxlIGV4aXN0cy4uLiBvdmVyd3JpdGUgdGhlIGRvY3VtZW50XG4gICAgICBkYkVudHJ5Ll9yZXYgPSBleGlzdGluZ0RvYy5fcmV2O1xuICAgICAgcmV0dXJuIHRoaXMuZGIucHV0KGRiRW50cnkpO1xuICAgIH0pLmNhdGNoKGVycm9yT2JqID0+IHtcbiAgICAgIGlmIChlcnJvck9iai5tZXNzYWdlID09PSAnbWlzc2luZycpIHtcbiAgICAgICAgLy8gdGhlIGZpbGUgZG9lc24ndCBleGlzdCB5ZXQuLi5cbiAgICAgICAgcmV0dXJuIHRoaXMuZGIucHV0KGRiRW50cnkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5jYXRjaERiRXJyb3IoZXJyb3JPYmopO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIGdldEZpbGVMaXN0ICgpIHtcbiAgICByZXR1cm4gdGhpcy5kYi5hbGxEb2NzKClcbiAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgbGV0IHJlc3VsdCA9IFtdO1xuICAgICAgICByZXNwb25zZS5yb3dzLmZvckVhY2goZCA9PiB7XG4gICAgICAgICAgaWYgKGQuaWQgIT09ICd1c2VyUHJlZnMnKSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaChkLmlkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfSkuY2F0Y2godGhpcy5jYXRjaERiRXJyb3IpO1xuICB9XG4gIGdldEZpbGVSZXZpc2lvbnMgKCkge1xuICAgIHJldHVybiB0aGlzLmRiLmFsbERvY3MoKVxuICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICBsZXQgcmVzdWx0ID0ge307XG4gICAgICAgIHJlc3BvbnNlLnJvd3MuZm9yRWFjaChkID0+IHtcbiAgICAgICAgICBpZiAoZC5pZCAhPT0gJ3VzZXJQcmVmcycpIHtcbiAgICAgICAgICAgIHJlc3VsdFtkLmlkXSA9IGQudmFsdWUucmV2O1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9KS5jYXRjaCh0aGlzLmNhdGNoRGJFcnJvcik7XG4gIH1cbiAgdXBsb2FkU3ZnIChmaWxlT2JqKSB7XG4gICAgbGV0IGZpbGVuYW1lID0gZmlsZU9iai5uYW1lO1xuICAgIHJldHVybiB0aGlzLmdldEZpbGVSZXZpc2lvbnMoKS50aGVuKHJldmlzaW9uRGljdCA9PiB7XG4gICAgICAvLyBBc2sgbXVsdGlwbGUgdGltZXMgaWYgdGhlIHVzZXIgaGFwcGVucyB0byBlbnRlciBhbm90aGVyIGZpbGVuYW1lIHRoYXQgYWxyZWFkeSBleGlzdHNcbiAgICAgIHdoaWxlIChyZXZpc2lvbkRpY3RbZmlsZW5hbWVdKSB7XG4gICAgICAgIGxldCBuZXdOYW1lID0gdGhpcy5wcm9tcHQuY2FsbCh3aW5kb3csXG4gICAgICAgICAgZmlsZU9iai5uYW1lICsgJyBhbHJlYWR5IGV4aXN0cy4gUGljayBhIG5ldyBuYW1lLCBvciBsZWF2ZSBpdCB0aGUgc2FtZSB0byBvdmVyd3JpdGU6JyxcbiAgICAgICAgICBmaWxlT2JqLm5hbWUpO1xuICAgICAgICBpZiAoIW5ld05hbWUpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfSBlbHNlIGlmIChuZXdOYW1lID09PSBmaWxlbmFtZSkge1xuICAgICAgICAgIHJldHVybiBmaWxlbmFtZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBmaWxlbmFtZSA9IG5ld05hbWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBmaWxlbmFtZTtcbiAgICB9KS50aGVuKGZpbGVuYW1lID0+IHtcbiAgICAgIGlmIChmaWxlbmFtZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5zYXZlU3ZnQmxvYihmaWxlbmFtZSwgZmlsZU9iaikudGhlbigoKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuc2V0Q3VycmVudEZpbGUoZmlsZW5hbWUpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KS5jYXRjaCh0aGlzLmNhdGNoRGJFcnJvcik7XG4gIH1cbiAgZGVsZXRlU3ZnIChmaWxlbmFtZSkge1xuICAgIGlmICh0aGlzLmNvbmZpcm0uY2FsbCh3aW5kb3csICdBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlICcgKyBmaWxlbmFtZSArICc/JykpIHtcbiAgICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5kYi5nZXQoZmlsZW5hbWUpLCB0aGlzLmdldEN1cnJlbnRGaWxlbmFtZSgpXSkudGhlbihwcm9taXNlUmVzdWx0cyA9PiB7XG4gICAgICAgIGxldCBleGlzdGluZ0RvYyA9IHByb21pc2VSZXN1bHRzWzBdO1xuICAgICAgICBsZXQgY3VycmVudEZpbGUgPSBwcm9taXNlUmVzdWx0c1sxXTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGIucmVtb3ZlKGV4aXN0aW5nRG9jLl9pZCwgZXhpc3RpbmdEb2MuX3JldilcbiAgICAgICAgICAudGhlbihyZW1vdmVSZXNwb25zZSA9PiB7XG4gICAgICAgICAgICBpZiAoZmlsZW5hbWUgPT09IGN1cnJlbnRGaWxlKSB7XG4gICAgICAgICAgICAgIHRoaXMuc2V0Q3VycmVudEZpbGUobnVsbCkuY2F0Y2godGhpcy5jYXRjaERiRXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlbW92ZVJlc3BvbnNlO1xuICAgICAgICAgIH0pO1xuICAgICAgfSkuY2F0Y2godGhpcy5jYXRjaERiRXJyb3IpO1xuICAgIH1cbiAgfVxuICBkb3dubG9hZFN2ZyAoZmlsZW5hbWUpIHtcbiAgICB0aGlzLmdldFN2Z0Jsb2IoZmlsZW5hbWUpLnRoZW4oYmxvYiA9PiB7XG4gICAgICAvLyBjcmVhdGUgYSBmYWtlIGxpbmsuLi5cbiAgICAgIGxldCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuICAgICAgYS5zdHlsZSA9ICdkaXNwbGF5Om5vbmUnO1xuICAgICAgbGV0IHVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgICAgYS5ocmVmID0gdXJsO1xuICAgICAgYS5kb3dubG9hZCA9IGZpbGVuYW1lO1xuICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTtcbiAgICAgIGEuY2xpY2soKTtcbiAgICAgIHdpbmRvdy5VUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7XG4gICAgICBhLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYSk7XG4gICAgfSkuY2F0Y2godGhpcy5jYXRjaERiRXJyb3IpO1xuICB9XG59XG5cbk11cmUuVkFMSURfRVZFTlRTID0ge1xuICBmaWxlTGlzdENoYW5nZTogdHJ1ZSxcbiAgZmlsZUNoYW5nZTogdHJ1ZSxcbiAgZXJyb3I6IHRydWUsXG4gIHN2Z0xvYWRlZDogdHJ1ZVxufTtcblxubGV0IG11cmUgPSBuZXcgTXVyZSgpO1xuZXhwb3J0IGRlZmF1bHQgbXVyZTtcbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoi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
