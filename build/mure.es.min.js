import{namespaces}from"d3";import PouchDB from"pouchdb";import PouchDBAuthentication from"pouchdb-authentication";import{Model}from"uki";import xmlJs from"xml-js";import{createParser}from"scalpel";console.log(PouchDB),PouchDB.plugin(PouchDBAuthentication);var appList=[{name:"docs",description:"The core app / landing page for Mure",author:"Alex Bigelow",icon:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIxLjAuMiwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1MTIgNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6I0U2QUIwMjt9Cgkuc3Qxe29wYWNpdHk6MC4zO2ZpbGw6Izc1NzBCMztlbmFibGUtYmFja2dyb3VuZDpuZXcgICAgO30KCS5zdDJ7b3BhY2l0eTowLjQ1O2ZpbGw6I0U2QUIwMjtlbmFibGUtYmFja2dyb3VuZDpuZXcgICAgO30KCS5zdDN7b3BhY2l0eTowLjU1O2ZpbGw6Izc1NzBCMztlbmFibGUtYmFja2dyb3VuZDpuZXcgICAgO30KCS5zdDR7b3BhY2l0eTowLjI7ZmlsbDojRTZBQjAyO2VuYWJsZS1iYWNrZ3JvdW5kOm5ldyAgICA7fQoJLnN0NXtmaWxsOiM3NTcwQjM7fQo8L3N0eWxlPgo8cG9seWdvbiBjbGFzcz0ic3QwIiBwb2ludHM9IjMzOS4zLDQwNy4zIDI1Niw1MDYgMTcyLjcsNDA3LjMgIi8+Cjxwb2x5Z29uIGNsYXNzPSJzdDEiIHBvaW50cz0iMjE0LjEsMzcyLjIgMjk3LjUsMjczLjUgMzgwLjgsMzcyLjIgIi8+Cjxwb2x5Z29uIGNsYXNzPSJzdDIiIHBvaW50cz0iNTA2LDI3My41IDQyMi43LDM3Mi4yIDMzOS4zLDI3My41ICIvPgo8cG9seWdvbiBjbGFzcz0ic3QzIiBwb2ludHM9IjI1NiwyMzguNSAzMzkuMywxMzkuOCA0MjIuNywyMzguNSAiLz4KPHBvbHlnb24gY2xhc3M9InN0MiIgcG9pbnRzPSIyNTYsMjczLjUgMTcyLjcsMzcyLjIgODkuMywyNzMuNSAiLz4KPHBvbHlnb24gY2xhc3M9InN0MyIgcG9pbnRzPSI2LDIzOC41IDg5LjMsMTM5LjggMTcyLjcsMjM4LjUgIi8+Cjxwb2x5Z29uIGNsYXNzPSJzdDQiIHBvaW50cz0iMjk3LjUsMTM5LjggMjE0LjEsMjM4LjUgMTMwLjgsMTM5LjggIi8+Cjxwb2x5Z29uIGNsYXNzPSJzdDUiIHBvaW50cz0iMTcyLjcsMTA0LjcgMjU2LDYgMzM5LjMsMTA0LjcgIi8+Cjwvc3ZnPgo="},{name:"data-binder",description:"A Mure app that is responsible for (re)binding data to graphics",author:"Alex Bigelow",icon:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIxLjEuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1MTIgNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe29wYWNpdHk6MC42O2ZpbGw6I0U2QUIwMjt9Cgkuc3Qxe29wYWNpdHk6MC4zO2ZpbGw6I0U2QUIwMjt9Cgkuc3Qye29wYWNpdHk6MC42O2ZpbGw6Izc1NzBCMzt9Cgkuc3Qze2ZpbGw6Izc1NzBCMzt9Cgkuc3Q0e29wYWNpdHk6MC4zO2ZpbGw6Izc1NzBCMzt9Cgkuc3Q1e2ZpbGw6I0U2QUIwMjt9Cjwvc3R5bGU+CjxnPgoJPHBhdGggY2xhc3M9InN0MCIgZD0iTTExOS43LDI2Ny43di0yMy40YzU5LjYsMCw3Ny4zLTE5LjcsODMuMi0yNi4xYzE0LjEtMTUuNywxOS0zNy40LDI0LjItNjAuNGM1LjQtMjQsMTEtNDguOSwyNy45LTY4LjMKCQlDMjc0LjEsNjcuNiwzMDQuNiw1NywzNDguMyw1N3YyMy40Yy0zNi41LDAtNjEuMyw4LTc1LjgsMjQuNWMtMTMsMTQuOS0xNy43LDM1LjgtMjIuNyw1OGMtNS42LDI0LjktMTEuNCw1MC42LTI5LjYsNzAuOQoJCUMxOTkuNywyNTYuNiwxNjYuOCwyNjcuNywxMTkuNywyNjcuN3oiLz4KCTxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0xMTkuNyw0NTV2LTIzLjRjMzQuNCwwLDk0LjMtNDAuMiwxNjQuNC0xMTAuM2wxNi42LDE2LjZDMjQ3LjEsMzkxLjMsMTcyLjQsNDU1LDExOS43LDQ1NXoiLz4KCTxwYXRoIGNsYXNzPSJzdDIiIGQ9Ik03LjUsMjk5LjVjMzIuNy0yNi43LDU2LjYtNDcuMiw1Ni42LTYzLjhjMC0xMS03LTE2LjItMTcuOC0xNi4yYy05LjEsMC0xNi4yLDUuOC0yMi44LDExLjZMNiwyMTMuMwoJCWMxMy4zLTEzLjUsMjUuNy0xOS43LDQ1LTE5LjdjMjYuMywwLDQ0LjcsMTUuOSw0NC43LDQwLjJjMCwxOS43LTIwLjUsNDEuNC00MC42LDU4LjRjNi44LTAuOCwxNi0xLjUsMjItMS41aDI0Ljd2MjcuOEg3LjVWMjk5LjV6IgoJCS8+Cgk8cGF0aCBjbGFzcz0ic3QzIiBkPSJNOC4yLDEwMy45SDM5VjM5LjNIMTMuNFYxOC41YzE1LTIuOCwyNC44LTYuMywzNC43LTEyLjJoMjQuOHY5Ny43aDI2Ljh2MjcuMkg4LjJWMTAzLjl6Ii8+Cgk8cGF0aCBjbGFzcz0ic3Q0IiBkPSJNNi41LDQ4OC43bDE0LjgtMjAuNWM4LDYuOCwxOC4yLDExLjQsMjcuMywxMS40YzExLjgsMCwyMC4xLTMuOCwyMC4xLTExLjRjMC05LjEtNi42LTE0LjQtMzMuNC0xNC40VjQzMQoJCWMyMS42LDAsMjkuNi01LjMsMjkuNi0xMy43YzAtNy4yLTUuNy0xMS0xNS4yLTExYy04LjcsMC0xNS42LDMuNC0yMy45LDkuOUw5LjUsMzk2LjRjMTIuMy05LjksMjYuMi0xNS42LDQxLjgtMTUuNgoJCWMyNy43LDAsNDYuMywxMi4xLDQ2LjMsMzRjMCwxMS42LTcuOCwyMC4zLTIyLDI2djAuOGMxNC44LDQuMiwyNS44LDEzLjcsMjUuOCwyOC44YzAsMjIuOC0yMy4zLDM1LjMtNDkuMywzNS4zCgkJQzMxLjUsNTA1LjgsMTYsNDk5LjMsNi41LDQ4OC43eiIvPgoJPHJlY3QgeD0iMzA1LjQiIHk9IjE5MS42IiBjbGFzcz0ic3Q0IiB3aWR0aD0iMTI0LjkiIGhlaWdodD0iMTI0LjkiLz4KCTxjaXJjbGUgY2xhc3M9InN0MiIgY3g9IjQzNy43IiBjeT0iNzQuNSIgcj0iNjguMyIvPgoJPHBvbHlnb24gY2xhc3M9InN0MyIgcG9pbnRzPSI0MjcuMSwzNjkuMiAzNDguMyw1MDUuOCA1MDYsNTA1LjggCSIvPgoJPHBhdGggY2xhc3M9InN0NSIgZD0iTTM1My45LDQ0OS4yYy0zNC42LDAtNjUtNC41LTkwLjMtMTMuM2MtMjMuOC04LjMtNDMuOS0yMC43LTU5LjgtMzYuOGMtNTMtNTMuNy01MS44LTE0MC01MC45LTIwOS4zCgkJYzAuNi00NC44LDEuMi04Ny4yLTE0LTEwMi41Yy00LjYtNC43LTEwLjctNi44LTE5LjItNi44VjU3YzE0LjgsMCwyNi45LDQuNiwzNS45LDEzLjhjMjIsMjIuMywyMS40LDY3LjMsMjAuNywxMTkuMwoJCWMtMC45LDY4LjMtMiwxNDUuNyw0NC4yLDE5Mi41YzI4LjcsMjkuMSw3Mi4zLDQzLjIsMTMzLjUsNDMuMlY0NDkuMnoiLz4KPC9nPgo8L3N2Zz4K"},{name:"encoding-manager",description:"A Mure app that is responsible for learning / applying data constraints to graphics",author:"Alex Bigelow",icon:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIxLjEuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHdpZHRoPSI1MTJweCIgaGVpZ2h0PSI1MTJweCIgdmlld0JveD0iMCAwIDUxMiA1MTIiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDUxMiA1MTI7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbDojNzU3MEIzO30KCS5zdDF7ZmlsbDojRTZBQjAyO30KCS5zdDJ7b3BhY2l0eTowLjE7ZmlsbDojRTZBQjAyO2VuYWJsZS1iYWNrZ3JvdW5kOm5ldyAgICA7fQoJLnN0M3tvcGFjaXR5OjAuOTtmaWxsOiNFNkFCMDI7ZW5hYmxlLWJhY2tncm91bmQ6bmV3ICAgIDt9Cgkuc3Q0e29wYWNpdHk6MC4yO2ZpbGw6I0U2QUIwMjtlbmFibGUtYmFja2dyb3VuZDpuZXcgICAgO30KCS5zdDV7b3BhY2l0eTowLjg7ZmlsbDojRTZBQjAyO2VuYWJsZS1iYWNrZ3JvdW5kOm5ldyAgICA7fQoJLnN0NntvcGFjaXR5OjAuMztmaWxsOiNFNkFCMDI7ZW5hYmxlLWJhY2tncm91bmQ6bmV3ICAgIDt9Cgkuc3Q3e29wYWNpdHk6MC43O2ZpbGw6I0U2QUIwMjtlbmFibGUtYmFja2dyb3VuZDpuZXcgICAgO30KCS5zdDh7b3BhY2l0eTowLjQ7ZmlsbDojRTZBQjAyO2VuYWJsZS1iYWNrZ3JvdW5kOm5ldyAgICA7fQoJLnN0OXtvcGFjaXR5OjAuNjtmaWxsOiNFNkFCMDI7ZW5hYmxlLWJhY2tncm91bmQ6bmV3ICAgIDt9Cgkuc3QxMHtvcGFjaXR5OjAuNTtmaWxsOiNFNkFCMDI7ZW5hYmxlLWJhY2tncm91bmQ6bmV3ICAgIDt9Cjwvc3R5bGU+Cjxwb2x5Z29uIGNsYXNzPSJzdDAiIHBvaW50cz0iMjczLjksMzgxIDI3My45LDM0OS44IDE2NC41LDM0OS44IDE2NC41LDI3MS42IDIyMC4zLDI3MS42IDIyMC4zLDI0MC40IDE2NC41LDI0MC40IDE2NC41LDE2Mi4yIAoJMjIwLjMsMTYyLjIgMjIwLjMsMTMxIDE2NC41LDEzMSAxNjQuNSw1Mi45IDIyMC4zLDUyLjkgMjIwLjMsMjEuNiAxNjQuNSwyMS42IDE2NC41LDYgMTMzLjIsNiAxMzMuMiwyMS42IDc3LjQsMjEuNiA3Ny40LDUyLjkgCgkxMzMuMiw1Mi45IDEzMy4yLDEzMSA3Ny40LDEzMSA3Ny40LDE2Mi4yIDEzMy4yLDE2Mi4yIDEzMy4yLDI0MC40IDc3LjQsMjQwLjQgNzcuNCwyNzEuNiAxMzMuMiwyNzEuNiAxMzMuMiwzNDkuOCAyMy45LDM0OS44IAoJMjMuOSwzODEgMTMzLjIsMzgxIDEzMy4yLDQ1OS4xIDc3LjQsNDU5LjEgNzcuNCw0OTAuNCAxMzMuMiw0OTAuNCAxMzMuMiw1MDYgMTY0LjUsNTA2IDE2NC41LDQ5MC40IDIyMC4zLDQ5MC40IDIyMC4zLDQ1OS4xIAoJMTY0LjUsNDU5LjEgMTY0LjUsMzgxICIvPgo8cmVjdCB4PSIzMDkuNiIgeT0iNiIgY2xhc3M9InN0MSIgd2lkdGg9IjcxLjQiIGhlaWdodD0iNzEuNCIvPgo8cmVjdCB4PSI0MTYuNyIgeT0iNiIgY2xhc3M9InN0MiIgd2lkdGg9IjcxLjQiIGhlaWdodD0iNzEuNCIvPgo8cmVjdCB4PSIzMDkuNiIgeT0iMTEzLjEiIGNsYXNzPSJzdDMiIHdpZHRoPSI3MS40IiBoZWlnaHQ9IjcxLjQiLz4KPHJlY3QgeD0iNDE2LjciIHk9IjExMy4xIiBjbGFzcz0ic3Q0IiB3aWR0aD0iNzEuNCIgaGVpZ2h0PSI3MS40Ii8+CjxyZWN0IHg9IjMwOS42IiB5PSIyMjAuMyIgY2xhc3M9InN0NSIgd2lkdGg9IjcxLjQiIGhlaWdodD0iNzEuNCIvPgo8cmVjdCB4PSI0MTYuNyIgeT0iMjIwLjMiIGNsYXNzPSJzdDYiIHdpZHRoPSI3MS40IiBoZWlnaHQ9IjcxLjQiLz4KPHJlY3QgeD0iMzA5LjYiIHk9IjMyNy40IiBjbGFzcz0ic3Q3IiB3aWR0aD0iNzEuNCIgaGVpZ2h0PSI3MS40Ii8+CjxyZWN0IHg9IjQxNi43IiB5PSIzMjcuNCIgY2xhc3M9InN0OCIgd2lkdGg9IjcxLjQiIGhlaWdodD0iNzEuNCIvPgo8cmVjdCB4PSIzMDkuNiIgeT0iNDM0LjYiIGNsYXNzPSJzdDkiIHdpZHRoPSI3MS40IiBoZWlnaHQ9IjcxLjQiLz4KPHJlY3QgeD0iNDE2LjciIHk9IjQzNC42IiBjbGFzcz0ic3QxMCIgd2lkdGg9IjcxLjQiIGhlaWdodD0iNzEuNCIvPgo8L3N2Zz4K"}],defaultSvgDocTemplate='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="500" height="500">\n  <metadata id="mure">\n    <mure xmlns="http://mure-apps.github.io">\n    </mure>\n  </metadata>\n  <script id="mureInteractivityRunner" type="text/javascript">\n    <![CDATA[\n      ${mureInteractivityRunnerText}\n    ]]>\n  <\/script>\n</svg>\n',minimumSvgDoc='<svg>\n  <metadata id="mure">\n    <mure xmlns="http://mure-apps.github.io">\n    </mure>\n  </metadata>\n</svg>\n',defaultSvgDoc=eval("`"+defaultSvgDocTemplate+"`"),DocHandler=function(){function e(){babelHelpers.classCallCheck(this,e),this.selectorParser=createParser(),this.keyNames={},this.json2xmlSettings=Object.assign({compact:!1,indentCdata:!0},this.keyNames),this.xml2jsonSettings=Object.assign({compact:!1,nativeType:!0,alwaysArray:!0,addParent:!0},this.keyNames),this.defaultJsonDoc=this.xml2json(defaultSvgDoc),this.minimumJsDoc=this.xml2js(minimumSvgDoc)}return babelHelpers.createClass(e,[{key:"xml2js",value:function(e){return xmlJs.xml2js(e,this.xml2jsonSettings)}},{key:"xml2json",value:function(e){return xmlJs.xml2json(e,this.xml2jsonSettings)}},{key:"json2xml",value:function(e){return xmlJs.json2xml(e,this.json2xmlSettings)}},{key:"js2xml",value:function(e){return xmlJs.js2xml(e,this.json2xmlSettings)}},{key:"standardize",value:function(e,i){if(!i){if(!e._id)throw new Error("You must at least supply an id to standardize the document");e.currentSelection=e.currentSelection||null,e.contents=this.standardize(e.contents||{},this.minimumJsDoc)}return e}},{key:"iterate",value:function(e,i){var t=[];t.push(e);do{i(e=t.shift()),e.elements&&t.unshift.apply(t,babelHelpers.toConsumableArray(e.elements))}while(t.length>0)}},{key:"matchObject",value:function(e,i){}},{key:"selectAll",value:function(e,i){var t=this,M=this.selectorParser.parse(i),n=[];return this.iterate(e,function(e){t.matchObject(e,M)&&n.push(e)}),n}}]),e}(),docH=new DocHandler,Mure=function(e){function i(){babelHelpers.classCallCheck(this,i);var e=babelHelpers.possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));if(e.appList=appList,"undefined"==typeof document||"undefined"==typeof window)return babelHelpers.possibleConstructorReturn(e);e.CONTENT_FORMATS={exclude:0,blob:1,dom:2,base64:3},e.NSString="http://mure-apps.github.io",namespaces.mure=e.NSString;var t=document.getElementsByTagName("title")[0];return t=t?t.textContent:"",e.debugMode="localhost"===window.location.hostname&&t.startsWith("Mure"),e.currentApp=window.location.pathname.replace(/\//g,""),e.appList[e.currentApp]||(e.currentApp=null),e.db=new PouchDB("mure"),e.on("error",function(e){console.warn(e)}),e.catchDbError=function(i){e.trigger("error","Unexpected error reading PouchDB: "+i.message+"\n"+i.stack)},e.alert=function(e){return new Promise(function(i,t){window.alert(e),i(!0)})},e.confirm=function(e){return new Promise(function(i,t){i(window.confirm(e))})},e.prompt=function(e,i){return new Promise(function(t,M){t(window.prompt(e,i))})},e}return babelHelpers.inherits(i,e),babelHelpers.createClass(i,[{key:"customizeAlertDialog",value:function(e){this.alert=e}},{key:"customizeConfirmDialog",value:function(e){this.confirm=e}},{key:"customizePromptDialog",value:function(e){this.prompt=e}},{key:"openApp",value:function(e,i){i?window.open("/"+e,"_blank"):window.location.pathname="/"+e}},{key:"getOrInitDb",value:function(){var e=this,i=new PouchDB("mure"),t=window.localStorage.getItem("couchDbUrl");return t&&babelHelpers.asyncToGenerator(regeneratorRuntime.mark(function M(){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new PouchDB(t,{skip_setup:!0}),e.abrupt("return",i.sync(n,{live:!0,retry:!0}));case 2:case"end":return e.stop()}},M,e)}))().catch(function(i){e.alert("Error syncing with "+t+": "+i.message)}),i}},{key:"getStandardizedDoc",value:function(e){return this.db.get(e).catch(function(i){if("not_found"===i.name)return{_id:e,currentSelection:null,contents:JSON.parse(docH.defaultJsonDoc)};throw i}).then(function(e){return docH.standardize(e)})}},{key:"downloadDoc",value:function(){var e=babelHelpers.asyncToGenerator(regeneratorRuntime.mark(function e(i){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.db.get(i).then(function(e){var i=docH.js2xml(e.contents),t=document.createElement("a");t.style="display:none";var M=window.URL.createObjectURL(new window.Blob([i],{type:"image/svg+xml"}));t.href=M,t.download=e._id,document.body.appendChild(t),t.click(),window.URL.revokeObjectURL(M),t.parentNode.removeChild(t)}));case 1:case"end":return e.stop()}},e,this)}));return function(i){return e.apply(this,arguments)}}()}]),i}(Model),mure=new Mure;export default mure;